<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.newthread.framework.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.newthread.entity.User">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <constructor>
            <idArg column="user_account" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="user_sid" javaType="java.lang.Integer" jdbcType="INTEGER"/>
            <arg column="user_name" javaType="java.lang.String" jdbcType="VARCHAR"/>
            <arg column="password" javaType="java.lang.String" jdbcType="VARCHAR"/>
        </constructor>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from user
        where user_account = #{userAccount,jdbcType=VARCHAR}
    </delete>

    <insert id="insert" parameterType="com.newthread.entity.User">
        insert into user (user_account, user_sid, user_name,
        password)
        values (#{userAccount,jdbcType=VARCHAR}, #{userSid,jdbcType=INTEGER}, #{userName,jdbcType=VARCHAR},
        #{password,jdbcType=VARCHAR})
    </insert>

    <insert id="add" parameterType="com.newthread.entity.User">
        insert into user (user_account, user_name,
        password)
        values (#{userAccount,jdbcType=VARCHAR}, #{userName,jdbcType=VARCHAR},
        #{password,jdbcType=VARCHAR})
    </insert>
    <update id="updateInfo" parameterType="com.newthread.entity.User">
        update user
        set user_name = #{userName,jdbcType=VARCHAR},
        password = #{password,jdbcType=VARCHAR},
        user_account = #{userAccount,jdbcType=VARCHAR}
        where user_account = #{userAccount,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.newthread.entity.User">
        update user
        set user_sid = #{userSid,jdbcType=INTEGER},
        user_name = #{userName,jdbcType=VARCHAR},
        password = #{password,jdbcType=VARCHAR}
        where user_account = #{userAccount,jdbcType=VARCHAR}
    </update>

    <select id="getOneAdmin" resultMap="BaseResultMap">
        select user_account, user_sid, user_name, password
        from user
        where user_account in (select user_account from user_role as ur,role where role.role_name = 'admin')
        limit 1
    </select>

    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select user_account, user_sid, user_name, password
        from user
        where user_account = #{userAccount,jdbcType=VARCHAR}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
    select user_account, user_sid, user_name, password
    from user
  </select>

    <select id="checkPassword" parameterType="java.lang.String" resultType="java.lang.Integer">
        select user_sid from user where user.user_account = #{0} and password = #{1}
</select>

    <select id="getAllPermission" resultType="java.lang.String">
    select power_name FROM power WHERE power_number in (SELECT DISTINCT power_number FROM role_power WHERE role_number IN (select role_number from user_role WHERE user_account = #{0}));
  </select>

    <select id="exist" parameterType="java.lang.String" resultType="java.lang.Integer">
      select user_sid from user WHERE user_account = #{0}
    </select>

    <delete id="deleteUserRole" parameterType="java.lang.String">
        delete from user_role where user_account = #{0}
    </delete>

    <update id="updatePassword" parameterType="java.lang.String">
        update user set user.password = #{1} where user.user_account = #{0};
    </update>
</mapper>